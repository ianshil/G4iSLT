<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>List_lemmasT</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library List_lemmasT</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">PeanoNat</span>.<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">existsT</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">genT</span> <span class="id" title="var">gen</span>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">type_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_assoc_solve</span> <span class="id" title="var">G</span> := <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_assoc</span> <span class="id" title="var">G</span>); <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_assoc_solve2</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_assoc</span> <span class="id" title="var">G</span>); <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_assoc</span> <span class="id" title="var">H</span>); <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">eapp_assoc_solve2</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> := <span class="id" title="var">erewrite</span> &lt;- (<span class="id" title="var">app_assoc</span> <span class="id" title="var">G</span>); <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- (<span class="id" title="var">app_assoc</span> <span class="id" title="var">H</span>); <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_assoc_hyp</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_assoc</span> <span class="id" title="var">G</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_assoc_hyp_inv</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_assoc</span> <span class="id" title="var">G</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_inv_head</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_l</span> := <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_assoc</span> || <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_comm_cons</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r</span> := <br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_assoc</span> || <span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_comm_cons</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_app_nil</span> := <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_nil_l</span> || <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_nil_r</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_l_simp</span> := <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_assoc</span> || <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_comm_cons</span> || <span class="id" title="var">list_app_nil</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_simp</span> := <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_assoc</span> || <span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_comm_cons</span> || <span class="id" title="var">list_app_nil</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_l_simp'</span> := <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_assoc</span> || <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_comm_cons</span> || <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_nil_l</span><br/>
&nbsp;&nbsp;|| <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_nil_r</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_simp'</span> := <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_assoc</span> || <span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_comm_cons</span> || <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_nil_l</span><br/>
&nbsp;&nbsp;|| <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_nil_r</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_eq_assoc</span> := <span class="id" title="var">list_assoc_r</span> ; <span class="id" title="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">if_eq_rev_eq</span>: <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">a</span> = <span class="id" title="var">b</span> -&gt; (<span class="id" title="var">rev</span> <span class="id" title="var">a</span> = <span class="id" title="var">rev</span> <span class="id" title="var">b</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">if_rev_eq</span>: <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">rev</span> <span class="id" title="var">a</span> = <span class="id" title="var">rev</span> <span class="id" title="var">b</span>) -&gt; <span class="id" title="var">a</span> = <span class="id" title="var">b</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">pose</span> (@<span class="id" title="var">if_eq_rev_eq</span> <span class="id" title="var">T</span> (<span class="id" title="var">rev</span> <span class="id" title="var">a</span>) (<span class="id" title="var">rev</span> <span class="id" title="var">b</span>) <span class="id" title="var">H</span>).<br/>
<span class="id" title="tactic">rewrite</span> -&gt; !<span class="id" title="var">rev_involutive</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>.<br/>
<span class="id" title="tactic">exact</span> <span class="id" title="var">e</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_single</span> <span class="id" title="var">A</span> <span class="id" title="var">X</span> (<span class="id" title="var">v</span> : <span class="id" title="var">A</span>) <span class="id" title="var">Y</span>: <span class="id" title="var">X</span> ++ <span class="id" title="var">v</span> :: <span class="id" title="var">Y</span> = <span class="id" title="var">X</span> ++ [<span class="id" title="var">v</span>] ++ <span class="id" title="var">Y</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_2_2</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> <span class="id" title="var">l4</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
<span class="id" title="var">l1</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l2</span> = <span class="id" title="var">l3</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">l4</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>, <span class="id" title="var">l1</span> = <span class="id" title="var">l3</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">l5</span> /\ <span class="id" title="var">l4</span> = <span class="id" title="var">l5</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" title="var">l3</span> = <span class="id" title="var">l1</span> /\ <span class="id" title="var">a</span> = <span class="id" title="var">b</span> /\ <span class="id" title="var">l2</span> = <span class="id" title="var">l4</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>, <span class="id" title="var">l3</span> = <span class="id" title="var">l1</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l5</span> /\ <span class="id" title="var">l2</span> = <span class="id" title="var">l5</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">l4</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> <span class="id" title="var">l4</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">l5</span> [<span class="id" title="var">H4</span> <span class="id" title="var">H5</span>]] | [[<span class="id" title="var">H4</span> <span class="id" title="var">H5</span>] | [<span class="id" title="var">l5</span> [<span class="id" title="var">H4</span> <span class="id" title="var">H5</span>]]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_2_2T</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> <span class="id" title="var">l4</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
<span class="id" title="var">l1</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l2</span> = <span class="id" title="var">l3</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">l4</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="var">existsT2</span> <span class="id" title="var">l5</span>, (<span class="id" title="var">l1</span> = <span class="id" title="var">l3</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">l5</span>) * (<span class="id" title="var">l4</span> = <span class="id" title="var">l5</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l2</span>)) +<br/>
&nbsp;&nbsp;(((<span class="id" title="var">l3</span> = <span class="id" title="var">l1</span>)* (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>) * (<span class="id" title="var">l2</span> = <span class="id" title="var">l4</span>)) +<br/>
&nbsp;&nbsp;(<span class="id" title="var">existsT</span> <span class="id" title="var">l5</span>, (<span class="id" title="var">l3</span> = <span class="id" title="var">l1</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l5</span>) * (<span class="id" title="var">l2</span> = <span class="id" title="var">l5</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">l4</span>))).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> <span class="id" title="var">l4</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">l5</span> [<span class="id" title="var">H4</span> <span class="id" title="var">H5</span>]] | [[[<span class="id" title="var">H4</span> <span class="id" title="var">H5</span>]] | [<span class="id" title="var">l5</span> [<span class="id" title="var">H4</span> <span class="id" title="var">H5</span>]]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_3_2</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}  (<span class="id" title="var">Gam</span> <span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">G'</span> <span class="id" title="var">H'</span> <span class="id" title="var">Gam1</span> <span class="id" title="var">Delt1</span> <span class="id" title="var">Gam2</span> <span class="id" title="var">Delt2</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> <span class="id" title="var">J</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span>, <span class="id" title="var">Delt1</span>) :: <span class="id" title="var">H</span> ++ (<span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt2</span>) :: <span class="id" title="var">J</span> = <span class="id" title="var">G'</span> ++ (<span class="id" title="var">Gam</span>, <span class="id" title="var">Delt</span>) :: <span class="id" title="var">H'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">G</span> = <span class="id" title="var">G'</span> ++ (<span class="id" title="var">Gam</span>,<span class="id" title="var">Delt</span>) :: <span class="id" title="var">l</span> /\ <span class="id" title="var">H'</span> = <span class="id" title="var">l</span> ++ (<span class="id" title="var">Gam1</span>, <span class="id" title="var">Delt1</span>) :: <span class="id" title="var">H</span> ++ (<span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt2</span>) :: <span class="id" title="var">J</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">G'</span> = <span class="id" title="var">G</span> /\ <span class="id" title="var">Gam1</span> = <span class="id" title="var">Gam</span> /\ <span class="id" title="var">Delt1</span> = <span class="id" title="var">Delt</span> /\ <span class="id" title="var">H'</span> =  <span class="id" title="var">H</span> ++ (<span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt2</span>) :: <span class="id" title="var">J</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>, <span class="id" title="var">G'</span> = <span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span>, <span class="id" title="var">Delt1</span>) :: <span class="id" title="var">l1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> = <span class="id" title="var">l1</span> ++ (<span class="id" title="var">Gam</span>, <span class="id" title="var">Delt</span>) :: <span class="id" title="var">l2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H'</span> = <span class="id" title="var">l2</span> ++ (<span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt2</span>) :: <span class="id" title="var">J</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">G'</span> = <span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span>,<span class="id" title="var">Delt1</span>) :: <span class="id" title="var">H</span> /\ <span class="id" title="var">Gam2</span> = <span class="id" title="var">Gam</span> /\ <span class="id" title="var">Delt2</span> = <span class="id" title="var">Delt</span> /\ <span class="id" title="var">J</span> = <span class="id" title="var">H'</span> ) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">G'</span> = <span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span>, <span class="id" title="var">Delt1</span>) :: <span class="id" title="var">H</span> ++ (<span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt2</span>) :: <span class="id" title="var">l</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">J</span> = <span class="id" title="var">l</span>++ (<span class="id" title="var">Gam</span>, <span class="id" title="var">Delt</span>) ::<span class="id" title="var">H'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">l1</span> <span class="id" title="var">m1</span> <span class="id" title="var">G'</span> <span class="id" title="var">H'</span> <span class="id" title="var">l2</span> <span class="id" title="var">m2</span> <span class="id" title="var">l3</span> <span class="id" title="var">m3</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> <span class="id" title="var">J</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">G</span> <span class="id" title="var">J</span> <span class="id" title="var">H</span> <span class="id" title="var">l1</span> <span class="id" title="var">m1</span> <span class="id" title="var">G'</span> <span class="id" title="var">H'</span> <span class="id" title="var">l2</span> <span class="id" title="var">m2</span> <span class="id" title="var">l3</span> <span class="id" title="var">m3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">G</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">J</span> <span class="id" title="var">H</span> <span class="id" title="var">l1</span> <span class="id" title="var">m1</span> <span class="id" title="var">G'</span> <span class="id" title="var">H'</span> <span class="id" title="var">l2</span> <span class="id" title="var">m2</span> <span class="id" title="var">l3</span> <span class="id" title="var">m3</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">G'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="var">edestruct</span>  (<span class="id" title="var">partition_2_2</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H4</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H0</span> | [[<span class="id" title="var">H0</span> <span class="id" title="var">H5</span>] | <span class="id" title="var">H0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l5</span> [<span class="id" title="var">H0'</span> <span class="id" title="var">HH</span>]]. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">G'</span>, <span class="id" title="var">l5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H3</span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_inv_head</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l5</span> [<span class="id" title="var">H0'</span> <span class="id" title="var">H5</span>]]. <span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="var">app_assoc_hyp_inv</span> <span class="id" title="var">H</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;-  <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">G'</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">G</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHG</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H4</span> <span class="id" title="keyword">as</span> [ [<span class="id" title="var">ll</span> [<span class="id" title="var">HH1</span> <span class="id" title="var">HH2</span>]] | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[<span class="id" title="var">HH1</span> [<span class="id" title="var">HH2</span> [<span class="id" title="var">HH3</span>]]] | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ [<span class="id" title="var">ll1</span> [<span class="id" title="var">ll2</span> [<span class="id" title="var">HH1</span> [<span class="id" title="var">HH2</span> <span class="id" title="var">HH3</span>]]]] | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[<span class="id" title="var">HH1</span> [<span class="id" title="var">HH2</span> [<span class="id" title="var">HH3</span> <span class="id" title="var">HH4</span>]]] | [<span class="id" title="var">ll</span> [<span class="id" title="var">HH1</span> <span class="id" title="var">HH2</span>]]]]]]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">ll</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">ll1</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">ll2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">ll</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" title="var">Unshelve</span>.<br/>
<span class="id" title="var">all</span> : <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_app_canc1</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l2'</span>: <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span> = <span class="id" title="var">l1</span> ++ <span class="id" title="var">l2'</span>) &lt;-&gt; (<span class="id" title="var">l2</span> = <span class="id" title="var">l2'</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">iff</span>. <span class="id" title="tactic">split</span> ; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">exact</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_app_canc2</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l1'</span> <span class="id" title="var">l2</span>: <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span> = <span class="id" title="var">l1'</span> ++ <span class="id" title="var">l2</span>) &lt;-&gt; (<span class="id" title="var">l1</span> = <span class="id" title="var">l1'</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">iff</span>. <span class="id" title="tactic">split</span> ; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">if_eq_rev_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; !<span class="id" title="var">rev_app_distr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">eq_app_canc1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">if_rev_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">exact</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_cons_single</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">l1</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l2</span> = (<span class="id" title="var">l1</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">l2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_2_3</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> <span class="id" title="var">l4</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l1</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">b</span> :: <span class="id" title="var">l2</span> = <span class="id" title="var">l3</span> ++ <span class="id" title="var">l4</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">l3</span> = <span class="id" title="var">l1</span> /\ <span class="id" title="var">l4</span> = <span class="id" title="var">a</span> :: <span class="id" title="var">b</span> :: <span class="id" title="var">l2</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>, <span class="id" title="var">l1</span> = <span class="id" title="var">l3</span> ++ <span class="id" title="var">l5</span> /\ <span class="id" title="var">l4</span> = <span class="id" title="var">l5</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">b</span> :: <span class="id" title="var">l2</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">l3</span> = <span class="id" title="var">l1</span> ++ [<span class="id" title="var">a</span>] /\ <span class="id" title="var">l4</span> = <span class="id" title="var">b</span> :: <span class="id" title="var">l2</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">l3</span> = <span class="id" title="var">l1</span> ++ [<span class="id" title="var">a</span>;<span class="id" title="var">b</span>] /\ <span class="id" title="var">l4</span> = <span class="id" title="var">l2</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>, <span class="id" title="var">l3</span> = <span class="id" title="var">l1</span> ++ [<span class="id" title="var">a</span>;<span class="id" title="var">b</span>] ++ <span class="id" title="var">l5</span> /\ <span class="id" title="var">l2</span> = <span class="id" title="var">l5</span> ++ <span class="id" title="var">l4</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H1</span> <span class="id" title="var">H2</span>]]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H1</span> <span class="id" title="var">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l3</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">a</span>::<span class="id" title="var">l1</span>). <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H1</span> <span class="id" title="var">H2</span>]]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [ [<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>] | [[<span class="id" title="var">l5</span> [<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>]] | [ [<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>] | [ [<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>] | [<span class="id" title="var">l5</span> [ <span class="id" title="var">H4</span> <span class="id" title="var">H5</span>]]]]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H2</span>]. <span class="id" title="var">app_assoc_hyp_inv</span> <span class="id" title="var">l3</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H2</span>]. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">app_inv_head</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H2</span>]. <span class="id" title="var">app_assoc_hyp_inv</span> <span class="id" title="var">l1</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H3</span>]. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">app_assoc_hyp_inv</span> <span class="id" title="var">l1</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l5</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">conj</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">subst_dep</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">G1</span> <span class="id" title="var">G2</span> : <span class="id" title="var">T</span>) <span class="id" title="var">P</span> (<span class="id" title="var">P2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">G</span> : <span class="id" title="var">T</span>), <span class="id" title="var">P</span> <span class="id" title="var">G</span>  -&gt; <span class="id" title="var">nat</span>)  (<span class="id" title="var">D1</span> : <span class="id" title="var">P</span> <span class="id" title="var">G1</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G1</span> = <span class="id" title="var">G2</span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">D2</span> : <span class="id" title="var">P</span> <span class="id" title="var">G2</span>), <span class="id" title="var">P2</span> <span class="id" title="var">G1</span> <span class="id" title="var">D1</span> = <span class="id" title="var">P2</span> <span class="id" title="var">G2</span> <span class="id" title="var">D2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">G1</span> <span class="id" title="var">G2</span> <span class="id" title="var">P</span> <span class="id" title="var">P2</span> <span class="id" title="var">D1</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">D1</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">D1</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">D1</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">finish_ht_admis_ex1</span> := <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">le_n_S</span>;  <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">finish_ht_admis_ex2</span> := <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">le_n_S</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">find_trans_solve</span> :=      <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H1</span> : ?<span class="id" title="var">n1</span> &lt;= ?<span class="id" title="var">n2</span>, <span class="id" title="var">H2</span> : ?<span class="id" title="var">n2</span> &lt;= ?<span class="id" title="var">n3</span> |- ?<span class="id" title="var">n1</span> &lt;= ?<span class="id" title="var">n3</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">n1</span> <span class="id" title="var">n2</span> <span class="id" title="var">n3</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>) <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">finish_ht_admis_ex3</span> :=  <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">le_n_S</span>; <span class="id" title="var">find_trans_solve</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">ap_part_2_2</span> <span class="id" title="var">P1</span> <span class="id" title="var">l5</span> <span class="id" title="var">P3</span> <span class="id" title="var">P4</span> <span class="id" title="var">P5</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">partition_2_2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">P1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">P1</span> <span class="id" title="keyword">as</span> [ [<span class="id" title="var">l5</span> [<span class="id" title="var">P3</span> <span class="id" title="var">P4</span>]] | [ [<span class="id" title="var">P3</span> [<span class="id" title="var">P4</span> <span class="id" title="var">P5</span>]] |  [<span class="id" title="var">l5</span> [<span class="id" title="var">P3</span> <span class="id" title="var">P4</span>]]]].<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">ap_part_2_3</span> <span class="id" title="var">P5</span> <span class="id" title="var">l5</span> <span class="id" title="var">P55</span> := <span class="id" title="tactic">apply</span> <span class="id" title="var">partition_2_3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">P5</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">P5</span> <span class="id" title="keyword">as</span> [ [<span class="id" title="var">P5</span> <span class="id" title="var">PP5</span>] | [ [<span class="id" title="var">l5</span> [<span class="id" title="var">P5</span> <span class="id" title="var">PP5</span>]]<br/>
                                | [[<span class="id" title="var">P5</span> <span class="id" title="var">PP5</span>] | [[<span class="id" title="var">P5</span> <span class="id" title="var">PP5</span>] | [<span class="id" title="var">l5</span> [<span class="id" title="var">P5</span> <span class="id" title="var">PP5</span>]]]]]].<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr1</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">G0</span> <span class="id" title="var">l5</span> <span class="id" title="var">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">G0</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l5</span> ++ <span class="id" title="var">H</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="id" title="var">G0</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">l5</span>) ++  <span class="id" title="var">H</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_cons_single</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr2</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">G0</span> <span class="id" title="var">l5</span> <span class="id" title="var">H</span>,<br/>
&nbsp;&nbsp;((<span class="id" title="var">G0</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">l5</span>) ++ <span class="id" title="var">H</span> =  <span class="id" title="var">G0</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l5</span> ++ <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr4</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">G</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">E</span> : <span class="id" title="var">T1</span>) (<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Gam1</span> <span class="id" title="var">Gam2</span> (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span> ++ <span class="id" title="var">E</span> :: <span class="id" title="var">A</span> :: <span class="id" title="var">B</span> :: <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ ((<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">E</span>]) ++ <span class="id" title="var">A</span> :: <span class="id" title="var">B</span> :: <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr5</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">G</span> (<span class="id" title="var">E</span> <span class="id" title="var">B</span> : <span class="id" title="var">T1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Gam1</span> <span class="id" title="var">Gam2</span> (<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ ((<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">E</span>]) ++ <span class="id" title="var">B</span> :: <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span> ++ <span class="id" title="var">E</span> :: <span class="id" title="var">B</span> :: <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr6</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">E</span> : <span class="id" title="var">T1</span>) <span class="id" title="var">G</span> <span class="id" title="var">l5</span> <span class="id" title="var">Gam3</span> <span class="id" title="var">Gam2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam3</span> ++ <span class="id" title="var">E</span> :: <span class="id" title="var">l5</span> ++ <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (((<span class="id" title="var">Gam3</span> ++ [<span class="id" title="var">E</span>]) ++ <span class="id" title="var">l5</span>) ++ <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_cons_single</span> <span class="id" title="var">Gam3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">_</span> <span class="id" title="var">l5</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr7</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">G</span> (<span class="id" title="var">E</span> : <span class="id" title="var">T1</span>) <span class="id" title="var">l5</span> <span class="id" title="var">Gam3</span> <span class="id" title="var">Gam2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
<span class="id" title="var">G</span> ++ (((<span class="id" title="var">Gam3</span> ++ [<span class="id" title="var">E</span>]) ++ <span class="id" title="var">l5</span>) ++ <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam3</span> ++ <span class="id" title="var">E</span> :: <span class="id" title="var">l5</span> ++ <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr8</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">G</span> <span class="id" title="var">Gam1</span> <span class="id" title="var">Gam2</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">T1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
&nbsp;<span class="id" title="var">G</span> ++ ((<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">A</span>; <span class="id" title="var">B</span>]) ++ <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span> ++ <span class="id" title="var">A</span> :: <span class="id" title="var">B</span> :: <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr9</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">G</span> <span class="id" title="var">Gam1</span> <span class="id" title="var">Gam2</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">T1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span> ++ <span class="id" title="var">B</span> :: <span class="id" title="var">A</span> :: <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
<span class="id" title="var">G</span> ++ (((<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">B</span>]) ++ [<span class="id" title="var">A</span>]) ++ <span class="id" title="var">Gam2</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_cons_single</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">B</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_cons_single</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">A</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr10</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">G</span> <span class="id" title="var">Gam1</span> <span class="id" title="var">Gam4</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">T1</span>) <span class="id" title="var">l5</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
<span class="id" title="var">G</span> ++ ((<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">A</span>; <span class="id" title="var">B</span>] ++ <span class="id" title="var">l5</span>) ++ <span class="id" title="var">Gam4</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span> ++ <span class="id" title="var">A</span> :: <span class="id" title="var">B</span> :: <span class="id" title="var">l5</span> ++ <span class="id" title="var">Gam4</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr11</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">G</span> <span class="id" title="var">Gam1</span> <span class="id" title="var">Gam4</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">T1</span>) <span class="id" title="var">l5</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Delt</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">delt</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">H</span>,<br/>
<span class="id" title="var">G</span> ++ (<span class="id" title="var">Gam1</span> ++ <span class="id" title="var">B</span> :: <span class="id" title="var">A</span> :: <span class="id" title="var">l5</span> ++ <span class="id" title="var">Gam4</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ ((((<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">B</span>]) ++ [<span class="id" title="var">A</span>]) ++ <span class="id" title="var">l5</span>) ++ <span class="id" title="var">Gam4</span>, <span class="id" title="var">Delt</span>, <span class="id" title="var">delt</span>) :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_cons_single</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_cons_single</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">_</span> <span class="id" title="var">l5</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr13</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">a</span> (<span class="id" title="var">G</span> <span class="id" title="var">l5</span> <span class="id" title="var">H</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">G</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l5</span> ++ <span class="id" title="var">H</span> = (<span class="id" title="var">G</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">l5</span>) ++ <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_comm_cons</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr14</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">a</span> <span class="id" title="var">b</span> (<span class="id" title="var">F</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">F</span> ++ <span class="id" title="var">a</span> :: (<span class="id" title="var">G</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">H</span>) = (<span class="id" title="var">F</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">G</span>) ++ <span class="id" title="var">b</span> :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_comm_cons</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr15</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> <span class="id" title="var">Xt</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">X</span> : <span class="id" title="var">Xt</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">F</span> ++ (<span class="id" title="var">G</span> ++ <span class="id" title="var">H</span>), <span class="id" title="var">X</span>) = ((<span class="id" title="var">F</span> ++ <span class="id" title="var">G</span>) ++ <span class="id" title="var">H</span>, <span class="id" title="var">X</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr15_R</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> <span class="id" title="var">Xt</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">X</span> : <span class="id" title="var">Xt</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">X</span>, <span class="id" title="var">F</span> ++ (<span class="id" title="var">G</span> ++ <span class="id" title="var">H</span>)) = (<span class="id" title="var">X</span>, (<span class="id" title="var">F</span> ++ <span class="id" title="var">G</span>) ++ <span class="id" title="var">H</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr16'</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">F</span> ++ (<span class="id" title="var">a</span> :: <span class="id" title="var">G</span>) = (<span class="id" title="var">F</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">G</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr16</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> <span class="id" title="var">Xt</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">T</span>) (<span class="id" title="var">X</span> : <span class="id" title="var">Xt</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">F</span> ++ (<span class="id" title="var">a</span> :: <span class="id" title="var">G</span>), <span class="id" title="var">X</span>) = ((<span class="id" title="var">F</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">G</span>, <span class="id" title="var">X</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr16_R</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> <span class="id" title="var">Xt</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">T</span>) (<span class="id" title="var">X</span> : <span class="id" title="var">Xt</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">X</span>, <span class="id" title="var">F</span> ++ (<span class="id" title="var">a</span> :: <span class="id" title="var">G</span>)) = (<span class="id" title="var">X</span>, (<span class="id" title="var">F</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">G</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr17_R</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">Phi</span> : <span class="id" title="var">T2</span>) <span class="id" title="var">Delt1</span> (<span class="id" title="var">B</span> <span class="id" title="var">A</span> : <span class="id" title="var">T1</span>) <span class="id" title="var">eqr3</span> <span class="id" title="var">U</span> <span class="id" title="var">Psi2</span>,<br/>
(<span class="id" title="var">Phi</span>, <span class="id" title="var">Delt1</span> ++ <span class="id" title="var">B</span> :: <span class="id" title="var">A</span> :: <span class="id" title="var">eqr3</span> ++ <span class="id" title="var">U</span> :: <span class="id" title="var">Psi2</span>) =<br/>
(<span class="id" title="var">Phi</span>, (<span class="id" title="var">Delt1</span> ++ <span class="id" title="var">B</span> :: <span class="id" title="var">A</span> :: <span class="id" title="var">eqr3</span>) ++ <span class="id" title="var">U</span> :: <span class="id" title="var">Psi2</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr18</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">F</span> ++ <span class="id" title="var">G</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">H</span>) = (<span class="id" title="var">F</span> ++ <span class="id" title="var">G</span>) ++ <span class="id" title="var">a</span> :: <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr19</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">F</span> ++ <span class="id" title="var">G</span>) ++ <span class="id" title="var">a</span> :: <span class="id" title="var">H</span> = <span class="id" title="var">F</span> ++ (<span class="id" title="var">G</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">list_assoc_r</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr20</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">F</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">b</span> :: <span class="id" title="var">G</span> = <span class="id" title="var">F</span> ++ [<span class="id" title="var">a</span> ; <span class="id" title="var">b</span>] ++ <span class="id" title="var">G</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">list_assoc_r</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr21</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">F</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">b</span> :: <span class="id" title="var">G</span> = <span class="id" title="var">F</span> ++ [<span class="id" title="var">a</span> ; <span class="id" title="var">b</span>] ++ <span class="id" title="var">G</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">list_assoc_r</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr22</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">F</span> <span class="id" title="var">G</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">F</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">b</span> :: <span class="id" title="var">G</span> = (<span class="id" title="var">F</span> ++ [<span class="id" title="var">a</span>]) ++ <span class="id" title="var">b</span> :: <span class="id" title="var">G</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">list_assoc_r</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_rearr23</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">b</span> <span class="id" title="var">a</span> : <span class="id" title="var">T</span>) (<span class="id" title="var">F</span> <span class="id" title="var">G</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">a</span> :: <span class="id" title="var">F</span> ++ <span class="id" title="var">b</span> :: <span class="id" title="var">G</span> = (<span class="id" title="var">a</span> :: <span class="id" title="var">F</span>) ++ <span class="id" title="var">b</span> :: <span class="id" title="var">G</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">list_assoc_r</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_eq_app</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">a</span> :: <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt; <span class="id" title="var">y</span> = [] /\ <span class="id" title="var">z</span> = <span class="id" title="var">a</span> :: <span class="id" title="var">x</span> \/<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">y'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>), <span class="id" title="var">y</span> = <span class="id" title="var">a</span> :: <span class="id" title="var">y'</span> /\ <span class="id" title="var">x</span> = <span class="id" title="var">y'</span> ++ <span class="id" title="var">z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">injection</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_eq_appT</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">a</span> :: <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt; <span class="id" title="var">sum</span> ((<span class="id" title="var">y</span> = []) * (<span class="id" title="var">z</span> = <span class="id" title="var">a</span> :: <span class="id" title="var">x</span>)) <br/>
&nbsp;&nbsp;(<span class="id" title="var">sigT</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span> =&gt; <span class="id" title="var">prod</span> (<span class="id" title="var">y</span> = <span class="id" title="var">a</span> :: <span class="id" title="var">y'</span>) (<span class="id" title="var">x</span> = <span class="id" title="var">y'</span> ++ <span class="id" title="var">z</span>))).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">injection</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_eq_appT2</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> :: <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">y</span> = []) * (<span class="id" title="var">z</span> = <span class="id" title="var">a</span> :: <span class="id" title="var">x</span>)) +<br/>
&nbsp;&nbsp;<span class="id" title="var">existsT2</span> (<span class="id" title="var">y'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>), (<span class="id" title="var">y</span> = <span class="id" title="var">a</span> :: <span class="id" title="var">y'</span>) * (<span class="id" title="var">x</span> = <span class="id" title="var">y'</span> ++ <span class="id" title="var">z</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">app_eq_cons</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">p</span> :=<br/>
&nbsp;&nbsp;@<span class="id" title="var">cons_eq_app</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> <span class="id" title="var">a</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">app_eq_consT2</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">p</span> :=<br/>
&nbsp;&nbsp;@<span class="id" title="var">cons_eq_appT2</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> <span class="id" title="var">a</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_nilT</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l</span> ++ <span class="id" title="var">l'</span> = [] -&gt; (<span class="id" title="var">l</span> = []) * (<span class="id" title="var">l'</span> = []).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">l'</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">discriminate</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_app</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">w</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">w</span> ++ <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt; <span class="id" title="tactic">exists</span> (<span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">w</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">m</span> /\ <span class="id" title="var">z</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">x</span> \/ <span class="id" title="var">y</span> = <span class="id" title="var">w</span> ++ <span class="id" title="var">m</span> /\ <span class="id" title="var">x</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intro</span>. <span class="id" title="tactic">intro</span>.<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">w</span>.<br/>
<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">apply</span> <span class="id" title="var">cons_eq_app</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="tactic">exists</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">w</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">apply</span> <span class="id" title="var">IHw</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_appT</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">w</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">w</span> ++ <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt; <span class="id" title="var">sigT</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sum</span> ((<span class="id" title="var">w</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">z</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">x</span>)) ((<span class="id" title="var">y</span> = <span class="id" title="var">w</span> ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">x</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">z</span>))).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">w</span>.<br/>
<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">apply</span> <span class="id" title="var">cons_eq_appT</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="tactic">exists</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">w</span>). <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>.<br/>
<span class="id" title="tactic">apply</span> <span class="id" title="var">IHw</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e0</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">e0</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span> ; <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> ; <span class="id" title="tactic">subst</span> ; <span class="id" title="tactic">simpl</span> ; <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span> ; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_appT2</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">w</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">w</span> ++ <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt; <span class="id" title="var">existsT2</span> (<span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">w</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">z</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">x</span>)) + ((<span class="id" title="var">y</span> = <span class="id" title="var">w</span> ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">x</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">z</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">w</span>; <span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">cons_eq_appT2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H1</span> <span class="id" title="var">H2</span>]| [<span class="id" title="var">l</span> [? <span class="id" title="var">H3</span>]]]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">w</span>). <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHw</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l2</span> [[<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>] | [<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>]]]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">app_eq_consT</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">p</span> :=<br/>
&nbsp;&nbsp;@<span class="id" title="var">cons_eq_appT</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> <span class="id" title="var">a</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_eq_nil</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">u</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ++ <span class="id" title="var">u</span> :: <span class="id" title="var">y</span> = [] -&gt; <span class="id" title="var">False</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_nil</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cD</span>. <span class="id" title="tactic">discriminate</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_unitT2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span>:<span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> ++ <span class="id" title="var">y</span> = [<span class="id" title="var">a</span>] -&gt; ((<span class="id" title="var">x</span> = []) * (<span class="id" title="var">y</span> = [<span class="id" title="var">a</span>])) + ((<span class="id" title="var">x</span> = [<span class="id" title="var">a</span>]) * (<span class="id" title="var">y</span> = [])).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_nilT</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H2a</span> <span class="id" title="var">H2b</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">nil_eq_list</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> <span class="id" title="var">p</span> := @<span class="id" title="var">list_eq_nil</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">nil_eq_app</span> <span class="id" title="var">A</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">p</span> := @<span class="id" title="var">app_eq_nil</span> <span class="id" title="var">A</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">nil_eq_appT</span> <span class="id" title="var">A</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">p</span> := @<span class="id" title="var">app_eq_nilT</span> <span class="id" title="var">A</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">unit_eq_app</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> := @<span class="id" title="var">app_eq_unit</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">unit_eq_appT2</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> := @<span class="id" title="var">app_eq_unitT2</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_eq_single</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">u</span> <span class="id" title="var">v</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ++ <span class="id" title="var">u</span> :: <span class="id" title="var">y</span> = [<span class="id" title="var">v</span>] -&gt; <span class="id" title="var">x</span> = [] /\ <span class="id" title="var">y</span> = [] /\ <span class="id" title="var">u</span> = <span class="id" title="var">v</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">sD</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">app_cons_not_nil</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">contradiction</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_eq_singleT</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">u</span> <span class="id" title="var">v</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ++ <span class="id" title="var">u</span> :: <span class="id" title="var">y</span> = [<span class="id" title="var">v</span>] -&gt; <span class="id" title="var">prod</span> (<span class="id" title="var">x</span> = []) (<span class="id" title="var">prod</span> (<span class="id" title="var">y</span> = []) (<span class="id" title="var">u</span> = <span class="id" title="var">v</span>)).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_consT</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">sD</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">nil_eq_appT</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">cD</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H2</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_eq_singleT_nobrac</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">u</span> <span class="id" title="var">v</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ++ <span class="id" title="var">u</span> :: <span class="id" title="var">y</span> = [<span class="id" title="var">v</span>] -&gt; (<span class="id" title="var">x</span> = []) * (<span class="id" title="var">y</span> = []) * (<span class="id" title="var">u</span> = <span class="id" title="var">v</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_consT2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">sD</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">app_cons_not_nil</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">contradiction</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">single_eq_list</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">p</span> := @<span class="id" title="var">list_eq_single</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">single_eq_listT</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">p</span> := @<span class="id" title="var">list_eq_singleT</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">single_eq_listT_nobrac</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">p</span> := @<span class="id" title="var">list_eq_singleT_nobrac</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> (<span class="id" title="var">eq_sym</span> <span class="id" title="var">p</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nnn_app_eq</span>: <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>), [] ++ [] ++ [] ++ <span class="id" title="var">x</span> = <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eq_nnn_app</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) := <span class="id" title="var">eq_sym</span> (<span class="id" title="var">nnn_app_eq</span> <span class="id" title="var">x</span>).<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_singleton</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> :: <span class="id" title="var">l</span> = [<span class="id" title="var">a</span>] ++ <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">firstorder</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_cons_singleton</span> <span class="id" title="var">a</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">cons_singleton</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">tac_cons_singleton_arg</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">cons_singleton</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">tac_cons_singleton</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="keyword">context</span> [?<span class="id" title="var">a</span> :: ?<span class="id" title="var">l</span>]] =&gt; <span class="id" title="tactic">progress</span> (<span class="id" title="var">tac_cons_singleton_arg</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_nil_goal</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_l</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_nil_hyp_arg</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_nil_hyp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="keyword">context</span>[ [] ++ ?<span class="id" title="var">A</span> ] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="var">rem_nil_hyp_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="keyword">context</span>[ ?<span class="id" title="var">A</span> ++ [] ] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="var">rem_nil_hyp_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_nil</span> := <span class="id" title="var">rem_nil_hyp</span>; <span class="id" title="var">rem_nil_goal</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_single</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_r</span>; <span class="id" title="var">tac_cons_singleton</span>; <span class="id" title="var">rem_nil</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_bracket_middle_arg</span> <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> ++ ?<span class="id" title="var">l3</span> ++ ?<span class="id" title="var">l4</span> =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">add_empty_hyp_L</span> <span class="id" title="var">l</span> <span class="id" title="var">H</span> :=  <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_nil_l</span> <span class="id" title="var">l</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">add_empty_goal_L</span> <span class="id" title="var">l</span> :=  <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_nil_l</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">add_empty_hyp_R</span> <span class="id" title="var">l</span> <span class="id" title="var">H</span> :=  <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_nil_r</span> <span class="id" title="var">l</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">add_empty_goal_R</span> <span class="id" title="var">l</span> :=  <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_nil_r</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_empty_hyp_L</span> <span class="id" title="var">l</span> <span class="id" title="var">H</span> :=  <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_nil_l</span> <span class="id" title="var">l</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_empty_goal_L</span> <span class="id" title="var">l</span> :=  <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_nil_l</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_empty_hyp_R</span> <span class="id" title="var">l</span> <span class="id" title="var">H</span> :=  <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_nil_r</span> <span class="id" title="var">l</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rem_empty_goal_R</span> <span class="id" title="var">l</span> :=  <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_nil_r</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">breakdown</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">A</span> ++ ?<span class="id" title="var">B</span> = ?<span class="id" title="var">x</span> ++ ?<span class="id" title="var">y</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_app</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">sE</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H2</span> : [?<span class="id" title="var">a</span>] = ?<span class="id" title="var">A</span> ++ ?<span class="id" title="var">B</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">unit_eq_app</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>; <span class="id" title="var">sE</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>));<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_l</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H3</span> : <span class="id" title="keyword">context</span>[ ?<span class="id" title="var">x</span> ++ [] ] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_nil_r</span> <span class="id" title="var">x</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H3</span> : <span class="id" title="keyword">context</span>[ [] ++ ?<span class="id" title="var">x</span> ] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_nil_l</span> <span class="id" title="var">x</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">tac_cons_singleton_arg_hyp</span> <span class="id" title="var">H</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">cons_singleton</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">tac_cons_singleton_hyp</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="keyword">context</span> [?<span class="id" title="var">a</span> :: ?<span class="id" title="var">l</span>] |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">progress</span> (<span class="id" title="var">tac_cons_singleton_arg_hyp</span> <span class="id" title="var">H</span> <span class="id" title="var">a</span> <span class="id" title="var">nil</span> ||<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tac_cons_singleton_arg_hyp</span> <span class="id" title="var">H</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_s_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">tac_cons_singleton_hyp</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_assoc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_assoc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> || <span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">app_comm_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_l'_arg</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_assoc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> || <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">app_comm_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_l'_arg_conc</span> <span class="id" title="var">H</span> := <span class="id" title="var">list_assoc_l</span>; <span class="id" title="var">list_assoc_l'_arg</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_arg_conc</span> <span class="id" title="var">H</span> := <span class="id" title="var">list_assoc_r</span>; <span class="id" title="var">list_assoc_r_arg</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_singleton_hyp</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_r_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">tac_cons_singleton_hyp</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_singleton_hyp2</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_r_s_arg</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">non_empty</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">check_app_head</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">l2</span> ++ ?<span class="id" title="var">l3</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">check_app_tail</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| ?<span class="id" title="var">l3</span> ++ <span class="id" title="var">l2</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">clear_useless</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> = ?<span class="id" title="var">a</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] = [?<span class="id" title="var">a</span>] |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> = ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H1</span> : ?<span class="id" title="var">a</span>, <span class="id" title="var">H2</span> : ?<span class="id" title="var">a</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H1</span> : [?<span class="id" title="var">a</span>] = [?<span class="id" title="var">b</span>], <span class="id" title="var">H2</span> : ?<span class="id" title="var">c</span> = ?<span class="id" title="var">d</span> |- <span class="id" title="var">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>; <span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">d</span> = ?<span class="id" title="var">d</span> =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H1</span> : [?<span class="id" title="var">a</span>] = [?<span class="id" title="var">b</span>], <span class="id" title="var">H2</span> : ?<span class="id" title="var">c</span> = ?<span class="id" title="var">d</span> |- <span class="id" title="var">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>; <span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">d</span> = ?<span class="id" title="var">d</span> =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">clear_useless_weak</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> = ?<span class="id" title="var">a</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] = [?<span class="id" title="var">a</span>] |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> = ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H1</span> : ?<span class="id" title="var">a</span>, <span class="id" title="var">H2</span> : ?<span class="id" title="var">a</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_singleton</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> ( <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: [] = ?<span class="id" title="var">c</span> :: ?<span class="id" title="var">d</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> = ?<span class="id" title="var">c</span> :: [] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> = ?<span class="id" title="var">c</span> :: ?<span class="id" title="var">d</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ((?<span class="id" title="var">a</span>,?<span class="id" title="var">b</span>) = ?<span class="id" title="var">c</span>) |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">c</span> = (?<span class="id" title="var">a</span>,?<span class="id" title="var">b</span>) |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="var">clear_useless</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inversion_cons</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">l1</span> = ?<span class="id" title="var">b</span> :: ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">clear_useless</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inversion_pair</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="var">clear_useless</span>; <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : (?<span class="id" title="var">a</span>,?<span class="id" title="var">b</span>)=(?<span class="id" title="var">c</span>,?<span class="id" title="var">d</span>) |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="var">clear_useless</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_singleton_str</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> ( <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: [] = ?<span class="id" title="var">c</span> :: ?<span class="id" title="var">d</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> = ?<span class="id" title="var">c</span> :: [] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">a</span> :: ?<span class="id" title="var">b</span> = ?<span class="id" title="var">c</span> :: ?<span class="id" title="var">d</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ((?<span class="id" title="var">a</span>,?<span class="id" title="var">b</span>) = ?<span class="id" title="var">c</span>) |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">c</span> = (?<span class="id" title="var">a</span>,?<span class="id" title="var">b</span>) |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">C</span> ?<span class="id" title="var">a</span> = ?<span class="id" title="var">C</span> ?<span class="id" title="var">b</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="var">clear_useless</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tail_inv_singleton</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l1</span> ++ [<span class="id" title="var">a</span>] = <span class="id" title="var">l2</span> ++ [<span class="id" title="var">b</span>] -&gt; (<span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>) * (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">l2</span> <span class="id" title="var">c</span> <span class="id" title="var">d</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">IH1</span> <span class="id" title="var">IH2</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tail_inv_singleton2</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l1</span> ++ [<span class="id" title="var">a</span>;<span class="id" title="var">a'</span>] = <span class="id" title="var">l2</span> ++ [<span class="id" title="var">b</span>;<span class="id" title="var">b'</span>] -&gt; (<span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>) * (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>) * (<span class="id" title="var">a'</span> = <span class="id" title="var">b'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">l2</span> <span class="id" title="var">c</span> <span class="id" title="var">d</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H1</span> <span class="id" title="var">H2</span>] <span class="id" title="var">H3</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_insert1</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">Gam1</span> <span class="id" title="var">Gam2</span> <span class="id" title="var">Sigm1</span> <span class="id" title="var">Sigm2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">A</span>] ++ <span class="id" title="var">Gam2</span> = <span class="id" title="var">Sigm1</span> ++ <span class="id" title="var">Sigm2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">existsT2</span> <span class="id" title="var">Gam1'</span> <span class="id" title="var">Gam2'</span>, (<span class="id" title="var">Sigm1</span> ++ [<span class="id" title="var">B</span>] ++ <span class="id" title="var">Sigm2</span> = <span class="id" title="var">Gam1'</span> ++ [<span class="id" title="var">A</span>] ++ <span class="id" title="var">Gam2'</span>) *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, <span class="id" title="var">InT</span> <span class="id" title="var">B</span> <span class="id" title="var">Gam1</span> -&gt; <span class="id" title="var">InT</span> <span class="id" title="var">B</span> <span class="id" title="var">Gam1'</span>) *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, <span class="id" title="var">InT</span> <span class="id" title="var">B</span> <span class="id" title="var">Gam2</span> -&gt; <span class="id" title="var">InT</span> <span class="id" title="var">B</span> <span class="id" title="var">Gam2'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">intros</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Sigm2</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">C</span> <span class="id" title="var">HC</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appL</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">partition_2_2T</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">sD</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> (<span class="id" title="var">Sigm1</span> ++ [<span class="id" title="var">B</span>] ++ [<span class="id" title="var">t</span>] ++ <span class="id" title="var">Heq</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> <span class="id" title="var">Gam2</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">split</span>. <span class="id" title="var">list_assoc_r</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appE</span> <span class="id" title="tactic">in</span> <span class="id" title="var">X</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">X</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appL</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appR</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appR</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> (<span class="id" title="var">Gam1</span> ++ [<span class="id" title="var">B</span>]), (<span class="id" title="var">Sigm2</span>). <span class="id" title="tactic">split</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hyp</span>: <span class="id" title="var">t</span> :: <span class="id" title="var">Sigm2</span> = [<span class="id" title="var">t</span>] ++ <span class="id" title="var">Sigm2</span>). <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hyp</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">C</span> <span class="id" title="var">HC</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appL</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_r</span>. <span class="id" title="tactic">eexists</span> <span class="id" title="var">Gam1</span>, (<span class="id" title="var">Heq</span> ++ [<span class="id" title="var">B</span>] ++ [<span class="id" title="var">t</span>] ++ <span class="id" title="var">Sigm2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">C</span> <span class="id" title="var">HC</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appE</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HC</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HC</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appL</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appR</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appR</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <span class="id" title="var">InT_pair_triple</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t12</span> : <span class="id" title="var">T1</span>*<span class="id" title="var">T2</span>) : <span class="id" title="var">list</span> ((<span class="id" title="var">list</span> <span class="id" title="var">T1</span>) * (<span class="id" title="var">list</span> <span class="id" title="var">T2</span>) * <span class="id" title="var">T3</span>) -&gt; <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">InT_pt_hd</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span> : <span class="id" title="var">t12</span> = (<span class="id" title="var">t1</span>,<span class="id" title="var">t2</span>) -&gt; <span class="id" title="var">InT</span> <span class="id" title="var">t1</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">InT</span> <span class="id" title="var">t2</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">InT_pair_triple</span> <span class="id" title="var">t12</span> ((<span class="id" title="var">a</span>,<span class="id" title="var">b</span>,<span class="id" title="var">c</span>) :: <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">InT_pt_tl</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">InT_pair_triple</span> <span class="id" title="var">t12</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">InT_pair_triple</span> <span class="id" title="var">t12</span> ((<span class="id" title="var">a</span>,<span class="id" title="var">b</span>,<span class="id" title="var">c</span>) :: <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span>  <span class="id" title="var">InT_pt_I</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T1</span> <span class="id" title="var">T2</span> <span class="id" title="var">T3</span> : <span class="id" title="keyword">Type</span>} <span class="id" title="var">L1</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T1</span>) (<span class="id" title="var">l3</span> <span class="id" title="var">l4</span> : <span class="id" title="var">list</span> <span class="id" title="var">T2</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">T3</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">InT_pair_triple</span> (<span class="id" title="var">A</span>,<span class="id" title="var">B</span>) (<span class="id" title="var">L1</span> ++ [(<span class="id" title="var">l1</span> ++ [<span class="id" title="var">A</span>] ++ <span class="id" title="var">l2</span>, <span class="id" title="var">l3</span> ++ [<span class="id" title="var">B</span>] ++ <span class="id" title="var">l4</span>, <span class="id" title="var">d</span>)]).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">L1</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appR</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appR</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">a</span> <span class="id" title="var">b</span>] <span class="id" title="var">c</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span> 2. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHL1</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_singleton_app</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">L1</span> <span class="id" title="var">L2</span> <span class="id" title="var">L3</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">L1</span> ++ [<span class="id" title="var">A</span>] = <span class="id" title="var">L2</span> ++ [<span class="id" title="var">B</span>] ++ <span class="id" title="var">L3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">L3</span> = []) * (<span class="id" title="var">L1</span> = <span class="id" title="var">L2</span>) * (<span class="id" title="var">A</span> = <span class="id" title="var">B</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">existsT2</span> <span class="id" title="var">L4</span>, (<span class="id" title="var">L3</span> = <span class="id" title="var">L4</span> ++ [<span class="id" title="var">A</span>]) * (<span class="id" title="var">L1</span> = <span class="id" title="var">L2</span> ++ [<span class="id" title="var">B</span>] ++ <span class="id" title="var">L4</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">L1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">L2</span> <span class="id" title="var">L3</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">L2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">L2</span>; <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">L2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">L1</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHL1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="var">sD</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">InT_mid</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">A</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">InT</span> <span class="id" title="var">A</span> (<span class="id" title="var">l1</span> ++ [<span class="id" title="var">A</span>] ++ <span class="id" title="var">l2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appR</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appL</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">InT_singleton_mid</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">l3</span> <span class="id" title="var">l4</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> &lt;&gt; <span class="id" title="var">B</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l1</span> ++ [<span class="id" title="var">A</span>] ++ <span class="id" title="var">l2</span> = <span class="id" title="var">l3</span> ++ [<span class="id" title="var">B</span>] ++ <span class="id" title="var">l4</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">InT</span> <span class="id" title="var">A</span> <span class="id" title="var">l3</span> + <span class="id" title="var">InT</span> <span class="id" title="var">A</span> <span class="id" title="var">l4</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hneq</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">InT_mid</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">A</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">InT_appE</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hin</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">i</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_nil_or_tail_singleton</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">l</span> = []) + <span class="id" title="var">existsT2</span> <span class="id" title="var">l2</span> <span class="id" title="var">a</span>, <span class="id" title="var">l</span> = <span class="id" title="var">l2</span> ++ [<span class="id" title="var">a</span>].<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">nil</span>, <span class="id" title="var">a</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l2'</span> [<span class="id" title="var">a'</span> <span class="id" title="var">H</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">exists</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">l2'</span>), <span class="id" title="var">a'</span>. <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">InT_app_or</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">InT</span> <span class="id" title="var">A</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>) -&gt; <span class="id" title="var">InT</span> <span class="id" title="var">A</span> <span class="id" title="var">l1</span> + <span class="id" title="var">InT</span> <span class="id" title="var">A</span> <span class="id" title="var">l2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">X</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="tactic">intros</span>. <span class="id" title="var">remember</span> ((<span class="id" title="var">a</span> :: <span class="id" title="var">l1</span>) ++ <span class="id" title="var">l2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">X</span>.<br/>
<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heql</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_eq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heql</span>.<br/>
<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">X</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">X</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_cons</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">InT_or_app</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">InT</span> <span class="id" title="var">A</span> <span class="id" title="var">l1</span> + <span class="id" title="var">InT</span> <span class="id" title="var">A</span> <span class="id" title="var">l2</span>) -&gt; <span class="id" title="var">InT</span> <span class="id" title="var">A</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_l</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">X</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">i</span>.<br/>
<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">X</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">a</span>:: <span class="id" title="var">l1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">i</span>.<br/>
<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heql</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_eq</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heql</span>. <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_cons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">InT_cons</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl1</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">hd_tl_inv_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="keyword">context</span>[?<span class="id" title="var">a</span> :: <span class="id" title="var">nil</span>] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">fail</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="keyword">context</span>[?<span class="id" title="var">a</span> :: ?<span class="id" title="var">l</span>] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">cons_singleton</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_single_hyp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : (?<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> ?<span class="id" title="var">T</span>) = ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">list_assoc_r_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">tac_cons_singleton_hyp</span> <span class="id" title="var">H</span> ; <span class="id" title="var">rem_nil_hyp_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">list_assoc_r_single_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_r_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">tac_cons_singleton_hyp</span> <span class="id" title="var">H</span> ; <span class="id" title="var">rem_nil_hyp_arg</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_singleton_inversion</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">a</span>] ++ <span class="id" title="var">l1</span> = [<span class="id" title="var">b</span>] ++ <span class="id" title="var">l2</span> -&gt; (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>) * (<span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> *;  <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">firstorder</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_singleton_tl_inversion</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l1</span> ++ [<span class="id" title="var">a</span>] = <span class="id" title="var">l2</span> ++ [<span class="id" title="var">b</span>] -&gt; (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>) * (<span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">if_eq_rev_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">rev_unit</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">if_rev_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_app_hd</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] ++ ?<span class="id" title="var">l1</span> = [?<span class="id" title="var">b</span>] ++ ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_singleton_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [? <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">subst</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">subst</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_app_tl</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">l1</span> ++  [?<span class="id" title="var">a</span>] = ?<span class="id" title="var">l2</span> ++ [?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_singleton_tl_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [? <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">subst</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">subst</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_hd_inversion</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">a</span>] = [<span class="id" title="var">b</span>] ++ <span class="id" title="var">l</span> -&gt; ( (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>) * (<span class="id" title="var">l</span> = []) ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_tl_inversion</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">T</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">a</span>] = <span class="id" title="var">l</span> ++ [<span class="id" title="var">b</span>] -&gt; ( (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>) * (<span class="id" title="var">l</span> = []) ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">aa</span> <span class="id" title="var">bb</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_app_hd_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [?<span class="id" title="var">a</span>] ++ ?<span class="id" title="var">l1</span> = [?<span class="id" title="var">b</span>] ++ ?<span class="id" title="var">l2</span> =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_singleton_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="keyword">let</span> <span class="id" title="var">H'</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;| [?<span class="id" title="var">a</span>] = [?<span class="id" title="var">b</span>] ++ ?<span class="id" title="var">l2</span> =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_hd_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="keyword">let</span> <span class="id" title="var">H'</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;| [?<span class="id" title="var">b</span>] ++ ?<span class="id" title="var">l2</span> = [?<span class="id" title="var">a</span>] =&gt; <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_hd_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="keyword">let</span> <span class="id" title="var">H'</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_app_tl_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| ?<span class="id" title="var">l1</span> ++  [?<span class="id" title="var">a</span>] = ?<span class="id" title="var">l2</span> ++ [?<span class="id" title="var">b</span>] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_singleton_tl_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<span class="id" title="keyword">let</span> <span class="id" title="var">H'</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;| [?<span class="id" title="var">a</span>] = ?<span class="id" title="var">l2</span> ++ [?<span class="id" title="var">b</span>] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_tl_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="keyword">let</span> <span class="id" title="var">H'</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;| ?<span class="id" title="var">l2</span> ++ [?<span class="id" title="var">b</span>] = [?<span class="id" title="var">a</span>] =&gt; <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">app_tl_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="keyword">let</span> <span class="id" title="var">H'</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H'</span> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_app_hd_tl_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_r_single_arg</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_app_hd_arg</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_l'_arg</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_app_tl_arg</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">list_assoc_r_single_arg</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">clear_useless</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_app_hd_tl</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">l1</span> = ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">inv_app_hd_tl_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">tac_cons_singleton_eq_hyp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : (?<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> ?<span class="id" title="var">T</span>) = ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">tac_cons_singleton_hyp</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list_assoc_r_single_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_appT2_nn</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">w</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">w</span> ++ <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt; <span class="id" title="var">existsT2</span> (<span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">w</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">z</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">x</span>) * (<span class="id" title="var">m</span> &lt;&gt; [])) + ((<span class="id" title="var">y</span> = <span class="id" title="var">w</span> ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">x</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">z</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">w</span>; <span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">cons_eq_appT2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">H1</span> <span class="id" title="var">H2</span>]| [<span class="id" title="var">l</span> [? <span class="id" title="var">H3</span>]]]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">w</span>). <span class="id" title="tactic">left</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">split</span> ; <span class="id" title="tactic">try</span> <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHw</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l2</span> [[<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>] | [<span class="id" title="var">H3</span> <span class="id" title="var">H4</span>]]]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>. <span class="id" title="var">sD</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_nn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">sD</span>; <span class="id" title="tactic">subst</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_single_eq_dest_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">unit_eq_appT2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">sD</span>; <span class="id" title="tactic">subst</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_appT2_single_hdL</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">w</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">w</span>] ++ <span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">existsT2</span> <span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>,  ((<span class="id" title="var">y</span> = [<span class="id" title="var">w</span>] ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">x</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">z</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ ((<span class="id" title="var">y</span> = []) * (<span class="id" title="var">z</span> = [<span class="id" title="var">w</span>] ++ <span class="id" title="var">x</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_appT2_single_hdR</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">z</span> <span class="id" title="var">w</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">w</span> ++ <span class="id" title="var">x</span> = [<span class="id" title="var">y</span>] ++ <span class="id" title="var">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">existsT2</span> <span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>, (<span class="id" title="var">w</span> = [<span class="id" title="var">y</span>] ++ <span class="id" title="var">m</span>) * (<span class="id" title="var">z</span> = <span class="id" title="var">m</span> ++ <span class="id" title="var">x</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;( (<span class="id" title="var">w</span> = []) * (<span class="id" title="var">x</span> = [<span class="id" title="var">y</span>] ++ <span class="id" title="var">z</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_hdL</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_appT2_single_tlL</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">w</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> ++ [<span class="id" title="var">w</span>] = <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">existsT2</span> <span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>,  ((<span class="id" title="var">z</span> = <span class="id" title="var">m</span> ++ [<span class="id" title="var">w</span>]) * (<span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">m</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ ((<span class="id" title="var">z</span> = []) * (<span class="id" title="var">y</span> = <span class="id" title="var">x</span> ++ [<span class="id" title="var">w</span>])).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">list_nil_or_tail_singleton</span> <span class="id" title="var">z</span>). <span class="id" title="tactic">subst</span>.<br/>
&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">firstorder</span>. <span class="id" title="var">sD</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="var">list_assoc_l'_arg</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">tail_inv_singleton</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">sD</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_appT2_single_tlR</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) <span class="id" title="var">w</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> = <span class="id" title="var">x</span> ++ [<span class="id" title="var">w</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">existsT2</span> <span class="id" title="var">m</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>,  ((<span class="id" title="var">z</span> = <span class="id" title="var">m</span> ++ [<span class="id" title="var">w</span>]) * (<span class="id" title="var">x</span> = <span class="id" title="var">y</span> ++ <span class="id" title="var">m</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ ((<span class="id" title="var">z</span> = []) * (<span class="id" title="var">y</span> = <span class="id" title="var">x</span> ++ [<span class="id" title="var">w</span>])).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_tlL</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] = ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">app_single_eq_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = [?<span class="id" title="var">a</span>] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">app_single_eq_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] = [?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = ?<span class="id" title="var">l3</span> ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">app_eq_app_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_app_hd_tl_full</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_app_hd_tl</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="var">inversion_pair</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">tac_cons_singleton_eq_hyp</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest2</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="var">inv_app_hd_tl_full</span> ; <span class="id" title="tactic">subst</span> ; <span class="id" title="tactic">try</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] = ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">app_single_eq_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = [?<span class="id" title="var">a</span>] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">app_single_eq_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] = [?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : [?<span class="id" title="var">a</span>] ++ ?<span class="id" title="var">l2</span> = ?<span class="id" title="var">l3</span> ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_hdL</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = [?<span class="id" title="var">a</span>] ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_hdR</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = ?<span class="id" title="var">l3</span> ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">app_eq_app_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest3_arg_pre</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:[?<span class="id" title="var">a</span>] = ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="var">app_single_eq_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = [?<span class="id" title="var">a</span>] |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">app_single_eq_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:[?<span class="id" title="var">a</span>] = [?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest3_argL</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:[?<span class="id" title="var">a</span>] ++ ?<span class="id" title="var">l2</span> = ?<span class="id" title="var">l3</span> ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_hdL</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = [?<span class="id" title="var">a</span>] ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_hdR</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest3_argR</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>: ?<span class="id" title="var">l2</span> ++ [?<span class="id" title="var">a</span>] = ?<span class="id" title="var">l3</span> ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_tlL</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = ?<span class="id" title="var">l4</span> ++ [?<span class="id" title="var">a</span>] |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> <span class="id" title="var">app_eq_appT2_single_tlR</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest3_arg_app</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> = ?<span class="id" title="var">l3</span> ++ ?<span class="id" title="var">l4</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="var">app_eq_app_dest_arg</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest3_arg</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">progress</span> <span class="id" title="var">app_eq_app_dest3_arg_pre</span> <span class="id" title="var">H</span>) ||<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">progress</span> (<span class="id" title="var">list_assoc_r_single_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">app_eq_app_dest3_argL</span> <span class="id" title="var">H</span>)) ||<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">progress</span> (<span class="id" title="var">list_assoc_l'_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">app_eq_app_dest3_argR</span> <span class="id" title="var">H</span>)) ||<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">progress</span> (<span class="id" title="var">list_assoc_r_single_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">app_eq_app_dest3_arg_app</span> <span class="id" title="var">H</span>)).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest3</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="var">inv_app_hd_tl_full</span> ; <span class="id" title="tactic">subst</span> ; <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">H</span> : (?<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> ?<span class="id" title="var">T</span>) = ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">app_eq_app_dest3_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">sD</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>); <span class="id" title="tactic">try</span> (<span class="id" title="var">inv_app_hd_tl_full</span> ; <span class="id" title="tactic">subst</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">app_eq_app_dest3'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> ((<span class="id" title="var">inv_app_hd_tl_full</span> ; <span class="id" title="tactic">subst</span> ; <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">H</span> : (?<span class="id" title="var">l1</span> : <span class="id" title="var">list</span> ?<span class="id" title="var">T</span>) = ?<span class="id" title="var">l2</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="var">app_eq_app_dest3_arg</span> <span class="id" title="var">H</span>; <span class="id" title="var">sD</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>); <span class="id" title="tactic">try</span> (<span class="id" title="var">inv_app_hd_tl_full</span> ; <span class="id" title="tactic">subst</span>)).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">eapply_refl</span> <span class="id" title="var">tac</span> := <span class="id" title="tactic">eapply</span> <span class="id" title="var">tac</span>; <span class="id" title="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">assoc_mid_loc</span> <span class="id" title="var">L</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="keyword">context</span>[ ?<span class="id" title="var">l1</span> ++ ?<span class="id" title="var">l2</span> ++ <span class="id" title="var">L</span> ++ ?<span class="id" title="var">l3</span> ] ] =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">tac_match</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id" title="tactic">fail</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">l2</span> ++ ?<span class="id" title="var">s1</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| ?<span class="id" title="var">s1</span> ++ <span class="id" title="var">l2</span> =&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_nil_r</span> ?<span class="id" title="var">L1</span>)<br/>
&nbsp;&nbsp;| ?<span class="id" title="var">s1</span> ++ <span class="id" title="var">l2</span> ++ ?<span class="id" title="var">s2</span> =&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">_</span> <span class="id" title="var">s1</span>)<br/>
&nbsp;&nbsp;| ?<span class="id" title="var">s1</span> ++ ?<span class="id" title="var">s2</span> =&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">_</span> <span class="id" title="var">s1</span>); <span class="id" title="var">tac_match</span> <span class="id" title="var">s2</span> <span class="id" title="var">l2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">tac_match'</span> <span class="id" title="var">l1</span> <span class="id" title="var">AA</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id" title="tactic">fail</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AA</span> :: ?<span class="id" title="var">s1</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| ?<span class="id" title="var">s1</span> ++ [<span class="id" title="var">AA</span>] =&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_nil_r</span> ?<span class="id" title="var">L1</span>)<br/>
&nbsp;&nbsp;| ?<span class="id" title="var">s1</span> ++ <span class="id" title="var">AA</span> :: ?<span class="id" title="var">s2</span> =&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">_</span> <span class="id" title="var">s1</span>)<br/>
&nbsp;&nbsp;| ?<span class="id" title="var">s1</span> ++ ?<span class="id" title="var">s2</span> =&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">app_assoc</span> <span class="id" title="var">_</span> <span class="id" title="var">s1</span>); <span class="id" title="var">tac_match'</span> <span class="id" title="var">s2</span> <span class="id" title="var">AA</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">get_last_app</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| ?<span class="id" title="var">H1</span> ++ ?<span class="id" title="var">H2</span> =&gt; <span class="id" title="var">get_last_app</span> <span class="id" title="var">H2</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">constr</span>:(<span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">get_snd_last_app</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| ?<span class="id" title="var">H1</span> ++ ?<span class="id" title="var">H2</span> ++ ?<span class="id" title="var">H3</span> =&gt; <span class="id" title="var">get_snd_last_app</span> (<span class="id" title="var">H2</span> ++ <span class="id" title="var">H3</span>)<br/>
&nbsp;&nbsp;| ?<span class="id" title="var">H1</span> ++ ?<span class="id" title="var">H2</span> =&gt; <span class="id" title="keyword">constr</span>:(<span class="id" title="var">H1</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">constr</span>:(<span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">app_split_at</span> <span class="id" title="var">X</span> (<span class="id" title="var">T</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) : <span class="id" title="var">list</span> <span class="id" title="var">X</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">X</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">X</span> -&gt; <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">asa_single</span> : <span class="id" title="var">app_split_at</span> <span class="id" title="var">T</span> <span class="id" title="var">T</span> [] []<br/>
&nbsp;&nbsp;| <span class="id" title="var">asa_appL</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">app_split_at</span> <span class="id" title="var">T</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">app_split_at</span> <span class="id" title="var">T</span> (<span class="id" title="var">A</span> ++ <span class="id" title="var">D</span>) <span class="id" title="var">B</span> (<span class="id" title="var">C</span> ++ <span class="id" title="var">D</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">asa_appR</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">app_split_at</span> <span class="id" title="var">T</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">app_split_at</span> <span class="id" title="var">T</span> (<span class="id" title="var">D</span> ++ <span class="id" title="var">A</span>) (<span class="id" title="var">D</span> ++ <span class="id" title="var">B</span>) <span class="id" title="var">C</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">solve_asa</span> := <span class="id" title="tactic">apply</span> <span class="id" title="var">asa_single</span> || <br/>
&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> <span class="id" title="var">asa_appL</span> ; <span class="id" title="var">solve_asa</span>) || <br/>
&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> <span class="id" title="var">asa_appR</span> ; <span class="id" title="var">solve_asa</span>) .<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">asa_eq</span> <span class="id" title="var">X</span> (<span class="id" title="var">T</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) : <span class="id" title="var">app_split_at</span> <span class="id" title="var">T</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">A</span> = <span class="id" title="var">B</span> ++ <span class="id" title="var">T</span> ++ <span class="id" title="var">C</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">asa</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">asa</span> ; <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">list_eq_assoc</span>. <span class="id" title="var">list_eq_assoc</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>